<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <Fragment>

    <!-- Single Component Group to install -->
    <ComponentGroup Id="ProductComponents">

      <ComponentRef Id="DnaConfig"/>
      <ComponentRef Id="DnaWebCmd"/>
      <ComponentRef Id="DnaWebCommandLineDll"/>
      <ComponentRef Id="DnaWebCommandLineDepsJson"/>
      <ComponentRef Id="DnaWebCommandLineRuntimeConfigJson"/>
      <ComponentRef Id="DnaWebCoreDll"/>
      <ComponentRef Id="NewtonsoftJsonDll"/>
      <ComponentRef Id="Path"/>

    </ComponentGroup>
    
    <!-- Platform independent -->
    
    <!-- PATH environment variable for dnaweb.cmd file to work from anywhere -->
    <DirectoryRef Id="TARGETDIR">
      <Component Id="Path" Guid="{68048AC5-DF0A-492D-855E-E8657871A581}">
        <Environment Id="PATH" Name="PATH" Value="[INSTALLFOLDER]" Permanent="no" Part="last" Action="set" System="no" />
      </Component>
    </DirectoryRef>

    <!-- 64-bit Components -->
    <?if $(var.Platform)=x64 ?>

    <DirectoryRef Id="INSTALLFOLDER" FileSource="$(var.Dna.Web.CommandLine.TargetDir)\publish">

      <!-- dna.config -->
      <Component Id="DnaConfig" Guid="{67C3BEB8-EDD0-4CBE-AC98-C4C84B512803}" Win64="yes">
        <File Id="FileDnaConfig"
            Name="dna.config"
            DiskId="1"
            Vital="yes"
            KeyPath="yes" />

        <Shortcut Id="DnaConfig"
                  Name="Edit Default Configuration"
                  Advertise="yes"
                  Directory="InstallProgramMenuFolder"
                  WorkingDirectory="APPLICATIONROOTDIRECTORY"
                  Icon="edit.ico"
                 >
        </Shortcut>

        <RemoveFolder Id="RemoveProgramMenuFolder" Directory="InstallProgramMenuFolder" On="uninstall"/>

      </Component>

      <!-- dnaweb.cmd -->
      <Component Id="DnaWebCmd" Guid="{39AB170A-FD38-4A64-85A5-57B211EECE9D}" Win64="yes">
        <File Id="FileDnaWebCmd"
              Source="$(var.Dna.Web.CommandLine.ProjectDir)"
              Name="dnaweb.cmd"
              DiskId="1"
              Vital="yes"
              KeyPath="yes" />

        <Shortcut Id="DnaWebCmd"
                  Name="DnaWeb"
                  Advertise="yes"
                  Directory="InstallProgramMenuFolder"
                  WorkingDirectory="APPLICATIONROOTDIRECTORY"
                  Icon="icon.ico"
                 >
        </Shortcut>
      </Component>

      <!-- Dna.Web.CommandLine.dll -->
      <Component Id="DnaWebCommandLineDll" Guid="{A5721ACC-84D5-4D3A-A2B5-AEF2BF601456}" Win64="yes">
        <File Id="FileDnaWebCommandLineDll"
              Name="Dna.Web.CommandLine.dll"
              DiskId="1"
              Vital="yes"
              KeyPath="yes" />
      </Component>

      <!-- Dna.Web.CommandLine.deps.json -->
      <Component Id="DnaWebCommandLineDepsJson" Guid="{14DDF396-9C9D-44C2-AAD3-FF83D727D2BA}" Win64="yes">
        <File Id="FileDnaWebCommandLineDepsJson"
              Name="Dna.Web.CommandLine.deps.json"
              DiskId="1"
              Vital="yes"
              KeyPath="yes" />
      </Component>

      <!-- Dna.Web.CommandLine.runtimeconfig.json -->
      <Component Id="DnaWebCommandLineRuntimeConfigJson" Guid="{EB3B5083-7D39-416B-83C5-CADE50F3FB5D}" Win64="yes">
        <File Id="FileDnaWebCommandLineRuntimeConfigJson"
              Name="Dna.Web.CommandLine.runtimeconfig.json"
              DiskId="1"
              Vital="yes"
              KeyPath="yes" />
      </Component>

      <!-- Dna.Web.Core.dll -->
      <Component Id="DnaWebCoreDll" Guid="{B0787F00-252C-4772-8AAB-390114E42484}" Win64="yes">
        <File Id="FileDnaWebCoreDll"
              Name="Dna.Web.Core.dll"
              DiskId="1"
              Vital="yes"
              KeyPath="yes" />
      </Component>
      
      <!-- Newtonsoft.Json.dll -->
      <Component Id="NewtonsoftJsonDll" Guid="{AC80BA7F-1161-43B1-ACE7-86E64347C180}" Win64="yes">
        <File Id="FileNewtonsoftJsonDll"
              Name="Newtonsoft.Json.dll"
              DiskId="1"
              Vital="yes"
              KeyPath="yes" />
      </Component>

    </DirectoryRef>

    <?else?>

    <!-- 32-bit Components -->
    <DirectoryRef Id="INSTALLFOLDER" FileSource="$(var.Dna.Web.CommandLine.TargetDir)\publish">

      <!-- dna.config -->
      <Component Id="DnaConfig" Guid="{67C3BEB8-EDD0-4CBE-AC98-C4C84B512803}" Win64="no">
        <File Id="FileDnaConfig"
            Name="dna.config"
            DiskId="1"
            Vital="yes"
            KeyPath="yes" />

        <Shortcut Id="DnaConfig"
                  Name="Edit Default Configuration"
                  Advertise="yes"
                  Directory="InstallProgramMenuFolder"
                  WorkingDirectory="APPLICATIONROOTDIRECTORY"
                  Icon="edit.ico">
        </Shortcut>

        <RemoveFolder Id="RemoveProgramMenuFolder" Directory="InstallProgramMenuFolder" On="uninstall"/>
        
      </Component>

      <!-- dnaweb.cmd -->
      <Component Id="DnaWebCmd" Guid="{9808AACA-B840-4E4A-AC42-8CDD11519E23}" Win64="no">
        <File Id="FileDnaWebCmd"
              Source="$(var.Dna.Web.CommandLine.ProjectDir)"
              Name="dnaweb.cmd"
              DiskId="1"
              Vital="yes"
              KeyPath="yes" />

        <Shortcut Id="DnaWebCmd"
                  Name="DnaWeb"
                  Advertise="yes"
                  Directory="InstallProgramMenuFolder"
                  WorkingDirectory="APPLICATIONROOTDIRECTORY"
                  Icon="icon.ico"
                 >
        </Shortcut>
      </Component>

      <!-- Dna.Web.CommandLine.dll -->
      <Component Id="DnaWebCommandLineDll" Guid="{E11884F9-C670-49F6-BE34-EBE482319BF0}" Win64="no">
        <File Id="FileDnaWebCommandLineDll"
              Name="Dna.Web.CommandLine.dll"
              DiskId="1"
              Vital="yes"
              KeyPath="yes" />
      </Component>

      <!-- Dna.Web.CommandLine.deps.json -->
      <Component Id="DnaWebCommandLineDepsJson" Guid="{31C64945-7C82-42B1-8DBB-B11EF68D6045}" Win64="no">
        <File Id="FileDnaWebCommandLineDepsJson"
              Name="Dna.Web.CommandLine.deps.json"
              DiskId="1"
              Vital="yes"
              KeyPath="yes" />
      </Component>

      <!-- Dna.Web.CommandLine.runtimeconfig.json -->
      <Component Id="DnaWebCommandLineRuntimeConfigJson" Guid="{B778EF9A-FB4C-45FA-AC3A-13B99CC62502}" Win64="no">
        <File Id="FileDnaWebCommandLineRuntimeConfigJson"
              Name="Dna.Web.CommandLine.runtimeconfig.json"
              DiskId="1"
              Vital="yes"
              KeyPath="yes" />
      </Component>

      <!-- Dna.Web.Core.dll -->
      <Component Id="DnaWebCoreDll" Guid="{086872F9-8555-4C6A-A62C-554E3E1A22E9}" Win64="no">
        <File Id="FileDnaWebCoreDll"
              Name="Dna.Web.Core.dll"
              DiskId="1"
              Vital="yes"
              KeyPath="yes" />
      </Component>
      
      <!-- Newtonsoft.Json.dll -->
      <Component Id="NewtonsoftJsonDll" Guid="{3FD3F814-BA11-45C1-A642-3ED871AB21FF}" Win64="no">
        <File Id="FileNewtonsoftJsonDll"
              Name="Newtonsoft.Json.dll"
              DiskId="1"
              Vital="yes"
              KeyPath="yes" />
      </Component>

    </DirectoryRef>

    <?endif?>

  </Fragment>

</Wix>

